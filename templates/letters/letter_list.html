<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë‚˜ì—ê²Œ ì“°ëŠ” í¸ì§€</title>
  <link rel="stylesheet" href="/static/css/letters/letter_list.css">
  <style>
    body { max-width: 600px; margin: auto; }
/* 
    .delete-letter-btn {
      margin-left: 10px;
      padding: 3px 8px;
      font-size: 0.8em;
      color: white;
      background-color: #dc3545;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .delete-letter-btn:hover {
      background-color: #c82333;
    } */
  </style>
</head>
<body>
  <!-- í–„ë²„ê±° ë²„íŠ¼ -->
  <div class="hamburger-btn">
    <img src="/static/images/poststamp.png" alt="ìš°í‘œìŠ¤í‹°ì»¤ UI" width="50px">
  </div>

  <div class="page_cover"></div>

  <!-- ì‚¬ì´ë“œ ë©”ë‰´ -->
  <div id="menu">
    <ul class="nav">
      <li><a href="/letters/writing/">í¸ì§€ ì“°ê¸°</a></li>
      <li><a href="/letters/letter/">í¸ì§€ ëª©ë¡</a></li>
      <li><a href="/routines/">í¸ì§€ ë£¨í‹´</a></li>
      <li><a href="/auth/mypage/">ë§ˆì´í˜ì´ì§€</a></li>
      <li><a href="/auth/logout/">ë¡œê·¸ì•„ì›ƒ</a></li>
      <li><a href="/auth/signup/">íšŒì›ê°€ì…</a></li>
    </ul>
  </div>

  <!-- ëª¨ë‹¬ -->
  <div id="modalOverlay" style="display: none;"></div>
  <div id="letterModal" style="display: none;">
    <div id="popup">
      <h2 id="modalTitle"></h2>
      <p id="modalDate"></p>
      <p id="modalContent"></p>
      <img id="modalImageUrl" alt="í¸ì§€ ì´ë¯¸ì§€" style="width: 300px; display: block; margin: 0 auto;" />
      <button onclick="closeModal()">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- í¸ì§€ ëª©ë¡ -->
  <div class="letter-container">
    <ul class="tabs">
      <li data-tab-target="#past" onclick="showCategory(event)">ê³¼ê±°</li>
      <li data-tab-target="#today" class="active" onclick="showCategory(event)">ì˜¤ëŠ˜</li>
      <li data-tab-target="#future" onclick="showCategory(event)">ë¯¸ë˜</li>
    </ul>
    <div class="letters-section">
      <div id="past" data-tab-content style="display: none;">
        <h1>ğŸ“œ ê³¼ê±°ì˜ í¸ì§€</h1>
        <ul id="pastList"></ul>
      </div>
      <div id="today" data-tab-content class="active" style="display: block;">
        <h1>ğŸ“© ì˜¤ëŠ˜ì˜ í¸ì§€</h1>
        <ul id="todayList"></ul>
      </div>
      <div id="future" data-tab-content style="display: none;">
        <h1>ğŸ”® ë¯¸ë˜ì˜ í¸ì§€</h1>
        <ul id="futureList"></ul>
      </div>
    </div>
  </div>

  <script src="/static/js/script.js"></script>
  <script src="/static/js/modal.js"></script>
  <script>
    // íƒ­ ì „í™˜
    function showCategory(e) {
      document.querySelectorAll('.tabs li').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('[data-tab-content]').forEach(div => div.style.display = 'none');

      const targetId = e.target.getAttribute('data-tab-target');
      document.querySelector(targetId).style.display = 'block';
      e.target.classList.add('active');
    }

    // í¸ì§€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (API ì˜ˆì‹œ URLì€ /api/letters)
    async function fetchLetters() {
      try {
        const res = await fetchWithAuth('/api/letters/');;
        const letters = await res.json();

        const pastList = document.getElementById('pastList');
        const todayList = document.getElementById('todayList');
        const futureList = document.getElementById('futureList');

        letters.forEach(letter => {
          const li = document.createElement('li');
          li.textContent = `${letter.letter_date || ''} - ${letter.title}`;
          li.setAttribute('data-id', letter.id);
          li.className = 'modalList';
          li.style.listStyleType = 'none';

          const btn = document.createElement('button');
          btn.className = 'delete-letter-btn';
          btn.textContent = 'ì‚­ì œ';
          btn.setAttribute('data-letter-id', letter.id);
          li.appendChild(btn);

          if (letter.category === 'past') pastList.appendChild(li);
          else if (letter.category === 'today') todayList.appendChild(li);
          else if (letter.category === 'future') futureList.appendChild(li);
        });
      } catch (err) {
        console.error('í¸ì§€ ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', err);
      }
    }

    document.addEventListener('DOMContentLoaded', fetchLetters);
  </script>
</body>
</html>
